// –ö–æ–Ω—Ñ–∏–≥
const SB_URL='https://jttsgizkuyipolcnvanc.supabase.co',SB_KEY='sb_publishable_MV93VmhU8U2I-2m8UquKkw_Eril4zvp',supabase=window.supabase.createClient(SB_URL,SB_KEY);
let state={user:null,balance:0,inventory:[]},cases=[],skins=[],selectedCase=null,selectedCaseId=null,currentCaseSkins=[];

async function init(){console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...');await checkAuth();await loadData();if(state.user)await loadPlayer();setupModalListeners();updateUI();setupAdminDragDrop();}
function setupAdminDragDrop(){setTimeout(()=>{const e=document.getElementById('case-drop-zone');e&&(e.addEventListener('dragover',allowDrop),e.addEventListener('dragleave',dragLeave),console.log('Drag & drop –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω'))},100);}

function setupModalListeners(){document.querySelectorAll('.modal').forEach(e=>{e.addEventListener('click',function(t){t.target===this&&(this.style.display='none')})});}
function showAuth(){showLogin()}function showLogin(){document.getElementById('login-modal').style.display='block'}function showRegister(){document.getElementById('register-modal').style.display='block',document.getElementById('login-modal').style.display='none'}function closeModal(e){document.getElementById(e).style.display='none'}

async function handleRegister(){const e=document.getElementById('register-email').value.trim(),t=document.getElementById('register-password').value.trim(),a=document.getElementById('register-confirm').value.trim(),s=document.getElementById('register-error');if(s.textContent='',!e||!t||!a)return s.textContent='–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è';if(t.length<6)return s.textContent='–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 6 —Å–∏–º–≤–æ–ª–æ–≤';if(t!==a)return s.textContent='–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç';try{console.log('–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...');const{data:n,error:c}=await supabase.auth.signUp({email:e,password:t,options:{data:{email:e}}});if(c)throw c;console.log('Auth —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞:',n.user?.id),n.user&&(await supabase.from('users').insert([{id:n.user.id,email:n.user.email,balance:1e4,role:'user',created_at:new Date().toISOString()}]),alert('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –¢–µ–ø–µ—Ä—å –≤–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç.'),closeModal('register-modal'),showLogin())}catch(r){console.error('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:',r),s.textContent=r.message||'–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏'}}

async function handleLogin(){const e=document.getElementById('login-email').value.trim(),t=document.getElementById('login-password').value.trim(),a=document.getElementById('login-error');if(a.textContent='',!e||!t)return a.textContent='–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è';try{console.log('–í—Ö–æ–¥–∏–º...');const{data:s,error:n}=await supabase.auth.signInWithPassword({email:e,password:t});if(n)throw n;console.log('–í—Ö–æ–¥ —É—Å–ø–µ—à–µ–Ω:',s.user?.id),s.user&&(await supabase.from('users').select('id').eq('id',s.user.id).maybeSingle(),await supabase.from('users').insert([{id:s.user.id,email:s.user.email,balance:1e4,role:'user',created_at:new Date().toISOString()}])),closeModal('login-modal'),location.reload()}catch(c){console.error('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞:',c),a.textContent=c.message||'–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å'}}

async function checkAuth(){try{const{data:e,error:t}=await supabase.auth.getSession();if(t)throw t;if(e.session){state.user=e.session.user,console.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω:',state.user.email),document.getElementById('auth-btn').style.display='none',document.getElementById('logout-btn').style.display='block',document.getElementById('user-email').textContent=state.user.email;const{data:a}=await supabase.from('users').select('role').eq('id',state.user.id).single();a?.role==='admin'&&(document.getElementById('admin-btn').style.display='block')}else console.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω'),document.getElementById('auth-btn').style.display='block',document.getElementById('logout-btn').style.display='none',document.getElementById('admin-btn').style.display='none',document.getElementById('user-email').textContent='–ì–æ—Å—Ç—å'}catch(s){console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ auth:',s)}}async function logout(){await supabase.auth.signOut(),location.reload()}

async function loadData(){try{const[{data:e},{data:t}]=await Promise.all([supabase.from('cases').select('*'),supabase.from('skins').select('*')]);cases=e||[],skins=t||[],renderCases()}catch(a){console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:',a)}}async function loadPlayer(){if(!state.user)return;const{data:e}=await supabase.from('users').select('balance').eq('id',state.user.id).single();e&&(state.balance=e.balance);const{data:t}=await supabase.from('player_inventory').select('skin_id').eq('player_id',state.user.id);state.inventory=t||[],updateUI(),renderInventory()}

function updateUI(){document.getElementById('balance').textContent=state.balance,document.getElementById('inventory').textContent=state.inventory.length,document.getElementById('withdraw-balance').textContent=state.balance}function renderCases(){const e=document.getElementById('cases');if(!e)return;e.innerHTML=cases.length?cases.map(e=>`<div class="case" onclick="previewCase(${e.id})"><h3>${e.emoji||'üì¶'} ${e.name}</h3><p>${e.price} –º–æ–Ω–µ—Ç</p></div>`).join(''):'<p>–ö–µ–π—Å—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</p>'}function renderInventory(){const e=document.getElementById('inventory-list');if(!e)return;e.innerHTML=state.inventory.length?state.inventory.map(e=>{const t=skins.find(t=>t.id===e.skin_id);return`<div class="skin">${t?.name||'–°–∫–∏–Ω'} #${e.skin_id}</div>`}).join(''):'<p>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç</p>'}

function previewCase(e){selectedCase=cases.find(t=>t.id===e);if(!state.user)return alert('–í–æ–π–¥–∏—Ç–µ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–µ–π—Å–æ–≤'),showLogin();document.getElementById('preview-title').textContent=selectedCase.name,document.getElementById('preview-price').textContent=`–¶–µ–Ω–∞: ${selectedCase.price} –º–æ–Ω–µ—Ç`,document.getElementById('preview-modal').style.display='block'}async function openCase(){if(!selectedCase||!state.user)return alert('–û—à–∏–±–∫–∞');if(state.balance<selectedCase.price)return alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤'),closeModal('preview-modal');try{const e=await fetch('https://mute-night-5909.zummer-max405.workers.dev/api/open-case',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({player_id:state.user.id,case_id:selectedCase.id,case_price:selectedCase.price})}),t=await e.json();if(t.success){state.balance=t.newBalance,updateUI(),alert('–í—ã–∏–≥—Ä–∞–ª–∏: '+(t.skin||'—Å–∫–∏–Ω')),closeModal('preview-modal'),await loadPlayer()}else alert('–û—à–∏–±–∫–∞: '+(t.error||'–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'))}catch(a){alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è')}}

function showWithdraw(){if(!state.user)return alert('–í–æ–π–¥–∏—Ç–µ –¥–ª—è –≤—ã–≤–æ–¥–∞'),showLogin();if(state.balance<1e3)return alert('–ú–∏–Ω–∏–º—É–º 1000 –º–æ–Ω–µ—Ç');document.getElementById('withdraw-modal').style.display='block'}async function createWithdraw(){const e=parseInt(document.getElementById('withdraw-amount').value),t=document.getElementById('withdraw-tg').value.trim();if(e<1e3||e>state.balance||!t)return alert('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ');await supabase.from('withdrawal_requests').insert([{player_id:state.user.id,amount:e,telegram_contact:t,status:'pending'}]);alert('–ó–∞—è–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞!'),closeModal('withdraw-modal')}

async function adminPanel(){if(!state.user)return;document.getElementById('admin-modal').style.display='block';const{data:e}=await supabase.from('users').select('role').eq('id',state.user.id).single();if(e?.role!=='admin')return document.getElementById('admin-content').innerHTML='<p>–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</p>';showAdminTab('withdraw')}function showAdminTab(e){document.querySelectorAll('.admin-tab').forEach(t=>{t.style.display='none'}),document.querySelectorAll('.tab-btn').forEach(t=>{t.classList.remove('active')});const t=document.getElementById(`admin-${e}`);t&&(t.style.display='block'),event.target.classList.add('active'),e==='withdraw'?loadWithdrawRequests():e==='cases'?(loadCasesForAdmin(),loadAllSkinsForAdmin()):e==='skins'&&loadAllSkinsForAdmin()}async function loadWithdrawRequests(){try{const{data:e}=await supabase.from('withdrawal_requests').select('*').order('id',{ascending:!1});document.getElementById('withdraw-list').innerHTML=(e||[]).map(e=>`<div class="request-item"><strong>–ó–∞—è–≤–∫–∞ #${e.id}</strong><br>–ò–≥—Ä–æ–∫: ${e.player_id}<br>–°—É–º–º–∞: ${e.amount} –º–æ–Ω–µ—Ç<br>Telegram: ${e.telegram_contact}<br>–°—Ç–∞—Ç—É—Å: <span class="status-${e.status}">${e.status}</span>${e.status==='pending'?`<div style="margin-top:10px"><button onclick="approveRequest(${e.id})" style="background:#00b894;margin-right:5px">‚úÖ –û–¥–æ–±—Ä–∏—Ç—å</button><button onclick="rejectRequest(${e.id})" style="background:#f72585">‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å</button></div>`:''}</div>`).join('')}catch(t){console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞—è–≤–æ–∫:',t)}}async function approveRequest(e){if(!confirm('–û–¥–æ–±—Ä–∏—Ç—å?'))return;await supabase.from('withdrawal_requests').update({status:'approved'}).eq('id',e),adminPanel()}async function rejectRequest(e){if(!confirm('–û—Ç–∫–ª–æ–Ω–∏—Ç—å?'))return;await supabase.from('withdrawal_requests').update({status:'rejected'}).eq('id',e),adminPanel()}async function createNewCase(){const e=document.getElementById('case-name').value.trim(),t=document.getElementById('case-price').value;if(!e||!t)return alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è');await supabase.from('cases').insert([{name:e,price:t,emoji:'üì¶'}]);alert('–ö–µ–π—Å —Å–æ–∑–¥–∞–Ω'),await loadData()}

function allowDrop(e){e.preventDefault(),e.currentTarget.classList.add('drag-over')}function dragLeave(e){e.currentTarget.classList.remove('drag-over')}function dragStart(e,t){e.dataTransfer.setData('skinId',t),e.currentTarget.classList.add('dragging')}function dragEnd(e){e.currentTarget.classList.remove('dragging')}function dropOnCase(e){e.preventDefault(),e.currentTarget.classList.remove('drag-over');if(!selectedCaseId)return alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∫–µ–π—Å –∏–∑ —Å–ø–∏—Å–∫–∞ —Å–ª–µ–≤–∞');const t=e.dataTransfer.getData('skinId');t&&addSkinToCase(parseInt(t))}function addSkinToCase(e){if(currentCaseSkins.includes(e))return alert('–≠—Ç–æ—Ç —Å–∫–∏–Ω —É–∂–µ –µ—Å—Ç—å –≤ –∫–µ–π—Å–µ!');currentCaseSkins.push(e),updateCaseSkinsDisplay()}function removeSkinFromCase(e){currentCaseSkins=currentCaseSkins.filter(t=>t!==e),updateCaseSkinsDisplay()}function updateCaseSkinsDisplay(){const e=document.getElementById('case-skins-list');if(!e)return;e.innerHTML=currentCaseSkins.length?currentCaseSkins.map(e=>`<div class="case-skin-item" id="skin-in-case-${e}">–°–∫–∏–Ω #${e}<span class="remove-skin" onclick="removeSkinFromCase(${e})">√ó</span></div>`).join(''):'<p>–í –∫–µ–π—Å–µ –ø–æ–∫–∞ –Ω–µ—Ç —Å–∫–∏–Ω–æ–≤</p>'}

async function loadCasesForAdmin(){try{const{data:e}=await supabase.from('cases').select('*').order('id'),t=document.getElementById('cases-list-admin');t&&(t.innerHTML=e.map(e=>`<div class="drag-item case-admin-item" onclick="selectCase(${e.id})" style="cursor:pointer;${selectedCaseId===e.id?'border-color:#4cc9f0':''}"><div style="font-size:24px">${e.emoji||'üì¶'}</div><div style="font-size:.9em">${e.name}</div><div style="font-size:.8em;opacity:.7">${e.price} –º–æ–Ω–µ—Ç</div><button onclick="event.stopPropagation();deleteCase(${e.id})" style="background:#f72585;padding:3px 8px;font-size:.8em;margin-top:5px">–£–¥–∞–ª–∏—Ç—å</button></div>`).join(''))}catch(a){console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–µ–π—Å–æ–≤:',a)}}async function selectCase(e){selectedCaseId=e,document.querySelectorAll('.case-admin-item').forEach(t=>{t.style.borderColor='transparent'}),event.currentTarget.style.borderColor='#4cc9f0';const{data:t}=await supabase.from('cases').select('*').eq('id',e).single();t&&(document.getElementById('selected-case-info').innerHTML=`<h4>${t.emoji||'üì¶'} ${t.name}</h4><p>–¶–µ–Ω–∞: ${t.price} –º–æ–Ω–µ—Ç</p><p>ID: ${t.id}</p>`),await loadCaseSkins(e),document.getElementById('save-case-btn').style.display='block'}async function loadCaseSkins(e){try{const{data:t}=await supabase.from('case_skins').select(`skin_id,skins(*)`).eq('case_id',e);currentCaseSkins=t.map(e=>e.skin_id);const a=document.getElementById('case-skins-list');a&&(a.innerHTML=t.length?t.map(e=>`<div class="case-skin-item" id="skin-in-case-${e.skin_id}">${e.skins?.emoji||'üéÆ'} ${e.skins?.name||'–°–∫–∏–Ω'} <span class="remove-skin" onclick="removeSkinFromCase(${e.skin_id})">√ó</span></div>`).join(''):'<p>–í –∫–µ–π—Å–µ –ø–æ–∫–∞ –Ω–µ—Ç —Å–∫–∏–Ω–æ–≤</p>')}catch(s){console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫–∏–Ω–æ–≤ –∫–µ–π—Å–∞:',s)}}

async function saveCaseSkins(){if(!selectedCaseId)return alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∫–µ–π—Å');try{await supabase.from('case_skins').delete().eq('case_id',selectedCaseId);if(currentCaseSkins.length){const e=currentCaseSkins.map(e=>({case_id:selectedCaseId,skin_id:e,weight:100}));await supabase.from('case_skins').insert(e)}alert(`–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ! –í –∫–µ–π—Å –¥–æ–±–∞–≤–ª–µ–Ω–æ ${currentCaseSkins.length} —Å–∫–∏–Ω–æ–≤`),await loadCaseSkins(selectedCaseId)}catch(e){console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–µ–π—Å–∞:',e),alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: '+e.message)}}

async function loadAllSkinsForAdmin(){try{const{data:e}=await supabase.from('skins').select('*').order('id'),t=document.getElementById('skins-list-admin');t&&(t.innerHTML=e.map(e=>`<div class="drag-item" draggable="true" ondragstart="dragStart(event,${e.id})" ondragend="dragEnd(event)" id="skin-${e.id}"><div style="font-size:24px">${e.emoji||'üéÆ'}</div><div style="font-size:.9em">${e.name}</div><div style="font-size:.8em;opacity:.7">${e.price} –º–æ–Ω–µ—Ç</div><div style="font-size:.7em;color:${getRarityColor(e.rarity)}">${getRarityName(e.rarity)}</div><button onclick="event.stopPropagation();deleteSkin(${e.id})" style="background:#f72585;padding:3px 8px;font-size:.8em;margin-top:5px">–£–¥–∞–ª–∏—Ç—å</button></div>`).join(''))}catch(a){console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫–∏–Ω–æ–≤:',a)}}function getRarityColor(e){switch(e){case'common':return'#4cc9f0';case'rare':return'#4361ee';case'epic':return'#7209b7';case'legendary':return'#f72585';default:return'#ffffff'}}function getRarityName(e){switch(e){case'common':return'–û–±—ã—á–Ω—ã–π';case'rare':return'–†–µ–¥–∫–∏–π';case'epic':return'–≠–ø–∏—á–µ—Å–∫–∏–π';case'legendary':return'–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π';default:return'–û–±—ã—á–Ω—ã–π'}}

async function createNewSkin(){const e=document.getElementById('skin-name').value.trim(),t=parseInt(document.getElementById('skin-price').value),a=document.getElementById('skin-rarity').value,s=document.getElementById('skin-emoji').value.trim()||'üéÆ',n=document.getElementById('skin-image').value.trim();if(!e||!t||t<=0)return alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ —Ü–µ–Ω—É —Å–∫–∏–Ω–∞');try{await supabase.from('skins').insert([{name:e,price:t,rarity:a,emoji:s,image_url:n||null}]);alert('–°–∫–∏–Ω —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!'),document.getElementById('skin-name').value='',document.getElementById('skin-price').value='100',document.getElementById('skin-emoji').value='üéÆ',document.getElementById('skin-image').value='',await loadAllSkinsForAdmin()}catch(c){console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–∫–∏–Ω–∞:',c),alert('–û—à–∏–±–∫–∞: '+c.message)}}

async function deleteCase(e){if(!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –∫–µ–π—Å? –í—Å–µ —Å–≤—è–∑–∏ —Å–æ —Å–∫–∏–Ω–∞–º–∏ —Ç–∞–∫–∂–µ —É–¥–∞–ª—è—Ç—Å—è.'))return;try{await supabase.from('cases').delete().eq('id',e);alert('–ö–µ–π—Å —É–¥–∞–ª–µ–Ω'),await loadCasesForAdmin();if(selectedCaseId===e){selectedCaseId=null,document.getElementById('selected-case-info').innerHTML='<p>–í—ã–±–µ—Ä–∏—Ç–µ –∫–µ–π—Å —Å–ª–µ–≤–∞</p>',document.getElementById('case-skins-list').innerHTML='',document.getElementById('save-case-btn').style.display='none'}}catch(t){console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∫–µ–π—Å–∞:',t),alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: '+t.message)}}async function deleteSkin(e){if(!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Å–∫–∏–Ω? –û–Ω —Ç–∞–∫–∂–µ —É–¥–∞–ª–∏—Ç—Å—è –∏–∑ –≤—Å–µ—Ö –∫–µ–π—Å–æ–≤.'))return;try{await supabase.from('skins').delete().eq('id',e);alert('–°–∫–∏–Ω —É–¥–∞–ª–µ–Ω'),await loadAllSkinsForAdmin();currentCaseSkins.includes(e)&&(currentCaseSkins=currentCaseSkins.filter(t=>t!==e),updateCaseSkinsDisplay())}catch(t){console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å–∫–∏–Ω–∞:',t),alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: '+t.message)}}

async function openCaseWithSkins(){if(!selectedCase||!state.user)return alert('–û—à–∏–±–∫–∞');if(state.balance<selectedCase.price)return alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤'),closeModal('preview-modal');try{const{data:e}=await supabase.from('case_skins').select(`skin_id,weight,skins(*)`).eq('case_id',selectedCase.id);if(!e||!e.length)return alert('–í —ç—Ç–æ–º –∫–µ–π—Å–µ –Ω–µ—Ç —Å–∫–∏–Ω–æ–≤!');let t=e.reduce((t,a)=>t+(a.weight||100),0),a=Math.random()*t,s=null;for(const t of e){a-=t.weight||100;if(a<=0){s=t.skins;break}}s||(s=e[0].skins);const n=state.balance-selectedCase.price;await supabase.from('users').update({balance:n}).eq('id',state.user.id),await supabase.from('player_inventory').insert([{player_id:state.user.id,skin_id:s.id,created_at:new Date().toISOString()}]),state.balance=n,updateUI(),alert(`üéâ –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏: ${s.emoji||'üéÆ'} ${s.name} (${getRarityName(s.rarity)})!`),closeModal('preview-modal'),await loadPlayer()}catch(c){console.error('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–µ–π—Å–∞:',c),alert('–û—à–∏–±–∫–∞: '+(c.message||'–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å –∫–µ–π—Å'))}}

document.addEventListener('DOMContentLoaded',init);